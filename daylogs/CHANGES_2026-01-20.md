# Changes - January 20, 2026

## Summary of Changes

### 1. **io.py** - DICOM Series Loading
- **Added imports**: `tkinter`, `filedialog`, `Path`, and updated type hints to include `List`, `Dict`
- **New function**: `select_dicom_folder()` - Opens a GUI folder selection dialog for choosing DICOM directories
- **New function**: `load_dicom_series()` - Loads all DICOM files from a folder, extracts metadata (spacing, instance number, slice location), and returns a sorted list of dictionaries containing images and metadata

### 2. **analysis.py** - Multi-Slice Support
- **Updated `Catphan404Analyzer.__init__()`**:
  - Now accepts `dicom_series` parameter (list from `load_dicom_series()`)
  - Maintains backwards compatibility with single `image` input
  - Added `self.dicom_series` attribute
  - Added slice index attributes for each module:
    - `self.uniformity_slice_index = 0`
    - `self.high_contrast_slice_index = 1`
    - `self.ctp401_slice_index = 2`
    - `self.ctp515_slice_index = 3`

- **New method**: `_average_slices(slice_index)` - Averages a target slice with its two neighbors (handles edge cases)

- **Updated all `run_*()` methods**:
  - `run_uniformity()` - Uses `self.uniformity_slice_index` with slice averaging
  - `run_high_contrast()` - Uses `self.high_contrast_slice_index` with slice averaging
  - `run_ctp401()` - Uses `self.ctp401_slice_index` with slice averaging
  - `run_ctp515()` - Uses `self.ctp515_slice_index` with slice averaging (also fixed commented code block)

- **Cleanup**:
  - Removed undefined `run_slice_thickness()` method

### 3. **pyproject.toml** - Dependencies
- Removed `pathlib` (standard library, shouldn't be in pip dependencies)
- Added `scikit-image` (was missing but needed for image processing)

## Architecture Impact

The package now supports **two modes of operation**:

1. **Legacy mode**: Pass a single image to `Catphan404Analyzer` (backwards compatible)
2. **Series mode**: Pass a folder of DICOMs via `load_dicom_series()`, and each analysis module automatically selects and averages its designated slice

## Key Features Added

- **Folder selection dialog** for user-friendly DICOM directory selection
- **Automatic slice selection** with configurable indices per analysis module
- **Three-slice averaging** for improved image quality and noise reduction
- **Backwards compatibility** maintained for existing single-image workflows
